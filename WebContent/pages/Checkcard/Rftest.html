<HTML>

<body>
<center><h3> 控件演示网页 </h3></center>
<form name="form1">
<center><h3> 设备基本操作 </h3></center>
<center><h3><input type="button" onclick="javascript:RfInit()" value="打开设备" >
<input type="button" onclick="javascript:RfExit()" value="关闭设备" >
<input type="button" onclick="javascript:DevBeep()" value="蜂鸣" >
</form>
转换值：<input type="text" value="C9EEDBDAC3F7CCA9" id="Account" name="cval"  maxlength="16" size="16"> 
<form name="form2">
<input type="button" onclick="javascript:RfHex()" value="Hex_Asc" >
<input type="button" onclick="javascript:RfAsc()" value="Asc_Hex" >
</form>
<form name="form3">
<center><h3> 数据操作 </h3></center>
<center><h3><input type="button" onclick="javascript:RfLoadkey()" value="装载密钥" >
<input type="button" onclick="javascript:RfCard()" value="寻卡" >
<input type="button" onclick="javascript:RfAuthentication()" value="校验密码" >
<input type="button" onclick="javascript:RfRead()" value="读数据" > 
<input type="button" onclick="javascript:RfWrite()" value="写数据" >
<input type="button" onclick="javascript:RfChangekey()" value="修改卡密钥" >
<input type="button" onclick="javascript:RfHalt()" value="中止卡片" >
</form>

<label>密钥Mode：
  <select name="keyMode" id="st" >
  <option value="0" SELECTED>KeyA</option>
  <option value="4">KeyB</option>
  </select>
</label>

密钥Key:<input type="text" value="FFFFFFFFFFFF" name="keyin"  maxlength="12" size="12">
扇区号：<input type="text" value="1" name="secin"  maxlength="2" size="2"> 
<center>
块0：<input type="text" value="" name="RData"  maxlength="32" size="32"> 
<center>
块1：<input type="text" value="" name="RData1" maxlength="32" size="32"> 
<center>
块2：<input type="text" value="" name="RData2" maxlength="32" size="32"> 
<center>
块3：<input type="text" value="" name="RData3" maxlength="32" size="32"> 
<br>

</BODY>
<HEAD>
<TITLE>ATL 3.0 test page for object MWReaderCtl</TITLE>
</HEAD>
<BODY>&nbsp;
<OBJECT id=MWRFATL style="WIDTH: 0px; HEIGHT: 0px" 
codeBase=MwRFReader.cab#version=1,0,0,2
data=data:application/x-oleobject;base64,VPpLUhUXNkSyudxeJIvBwwADAAAAAAAAAAAAAA== 
classid=CLSID:524BFA54-1715-4436-B2B9-DC5E248BC1C3></OBJECT> 
<SCRIPT LANGUAGE=javascript>


var aa = 1;
var bb = 1;
var ret;
var address,address1,address2,address3;

MWRFATL.CloseReader();
	
function RfInit()//打开设备
{
        MWRFATL.CloseReader();
	bb=MWRFATL.OpenReader(0,115200);
        aa=MWRFATL.LastRet;
        if(aa==0)				
	alert("硬件版本号为："+bb);
        else
        alert("打开设备Fail!");
}

function RfExit()//关闭设备
{
	MWRFATL.CloseReader();
        aa=MWRFATL.LastRet;
        if(aa==0)
        alert("关闭设备Sucess!");
        else
        alert("关闭设备Fail!");
}
	

function DevBeep()//蜂鸣器蜂鸣
{
	bb=MWRFATL.RF_Beep(10);		//传入参数：设备单次蜂鸣时间
	aa=MWRFATL.LastRet;
        if(aa==0)
        alert("蜂鸣Sucess!");
        else
        alert("蜂鸣Fail!");
}

function RfHex()
{
        var cdata2=cval.value;
        var len=document.getElementById('cval').value.length;
        bb=MWRFATL.MF_hex_a(cdata2 , len)
        aa=MWRFATL.LastRet;
        if(aa==0)				
	alert("hex转换数据为："+bb);
        else
        alert("hex转换Fail!");
}

function RfAsc()
{
        var cdata1=cval.value;
        var len=document.getElementById('cval').value.length;
        bb=MWRFATL.MF_a_hex(cdata1,len)
        aa=MWRFATL.LastRet;
        if(aa==0)				
	alert("asc转换数据为："+bb);
        else
        alert("asc转换Fail!");
}

//-------------------------------------------------------	M1卡数据操作	 ----------------------------------------------------------//


//说明： 装载密钥 	
//参数：mode: 密码类型
//            0 ― KEY A
//            4 ― KEY B
//      secnr: 须装载密码的扇区号(0～15) 
//      key:  写入读写器的12字节新密码	  
// 返回： <0 错误		  
//        =0 密码正确
function RfLoadkey()
{
        key = keyin.value;
        sec = secin.value;
        ret = document.getElementById('keyMode').value;
        //alert(ret);
	MWRFATL.RF_LoadKey(ret,sec,key);
	aa=MWRFATL.LastRet;
	if(aa==0)
        alert("装载Sucess!");
        else
        alert("装载Fail!");
}


// 说明： 寻卡
// 返回： <>0 错误	  
//        =0 密码正确
function RfCard()
{      
        MWRFATL.MF_Reset(5);
	bb=MWRFATL.OpenCard(1);
	aa=MWRFATL.LastRet;
	if(aa==0)
        alert("卡片序列号为："+bb );
        else
        alert("寻卡Fail!");
}

// 说明： 核对密码
// 返回： <>0 错误	  
//        =0 密码正确
function RfAuthentication()
{
        sec = secin.value;
	MWRFATL.RF_Authentication(ret,sec);
	aa=MWRFATL.LastRet;
	if(aa==0)
        alert("验证Sucess!");
        else
        alert("验证Fail!");
}

// 说明： 读数据 
// 返回： <>0 错误	  
//        =0 密码正确
function RfRead()
{
        address=secin.value*4;
        address1=address+1;
        address2=address+2;
        address3=address+3;

        if(address>15)
        alert("SecError!");

	var block=MWRFATL.MF_Read(address); 
        RData.value=(block.slice(0,32));    
        var block1=MWRFATL.MF_Read(address1);
        RData1.value=(block1.slice(0,32));
        var block2=MWRFATL.MF_Read(address2);
        RData2.value=(block2.slice(0,32));
        var block3=MWRFATL.MF_Read(address3);
        aa=MWRFATL.LastRet;
        if(aa==0)
       {
        RData3.value=(block3.slice(0,32));
       }
        else
       {
        RData.value="";
        RData1.value="";
        RData2.value="";
        RData3.value="";
        alert("Read_Fail!");
       }
}


// 说明： 写数据
// 返回： <>0 错误		  
//        =0 密码正确
function RfWrite()
{
        address=secin.value*4;
        address1=address+1;
        address2=address+2;
        address3=address+3;
        
        if(address>15)
        alert("SecError!");

        //alert(RData.value);
	MWRFATL.MF_Write(address,RData.value);
	MWRFATL.MF_Write(address1,RData1.value);
	MWRFATL.MF_Write(address2,RData2.value);
	//MWRFATL.MF_Write(address3,RData3.value);
        aa=MWRFATL.LastRet;
	if(aa==0)
        alert("Write_Sucess!");      
        else
        alert("Write_Fail!"); 
     
}

// 说明： 修改密码 	  
// 返回： <>0 错误	  
//        =0 密码正确
function RfChangekey()
{
        address=secin.value*4;
        address3=address+3;
        
        if(address>15)
        alert("SecError!");

        var Changekey = keyin.value + "FF078069FFFFFFFFFFFF";
        MWRFATL.MF_Write(address3,Changekey);
        aa=MWRFATL.LastRet;
	if(aa==0)
        alert("Changekey_Sucess!");      
        else
        alert("Changekey_Fail!"); 
        
}

// 说明：中止卡片
// 返回： <>0 错误	  
//        =0 密码正确
function RfHalt()
{
       MWRFATL.CloseCard();
       aa=MWRFATL.LastRet;
       if(aa==0)
       alert("中止Sucess!");
       else
       alert("中止Fail!");
}


</SCRIPT>

</head>

</HTML>